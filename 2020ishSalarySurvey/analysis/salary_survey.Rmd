---
title: '2020 Salary Survey: Data Exploration'
date: "2/7/2021"
output:
  html_document:
    df_print: paged
    toc: true
    toc_depth: 3
    toc_float:
      collapsed: true
---


# Executive Summary 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls())
```


```{r, message = FALSE,echo = FALSE}
# Load Packages
#library(tidyverse)
library(formattable)
library(ggridges)
library(DescTools)
library(googlesheets4)
library(ggplot2)
library(dplyr)
library(tidyr)
library(viridis)
library(forcats)
library(ggridges)
library(pollster)
#library(kableExtra) 
```


```{r, message = FALSE, echo = FALSE, results='hide' }

# Download data  
# fn <- googledrive::drive_find("survey_responses_clean.csv", n_max = 1)
# 
# googledrive::drive_download(
#   file = fn,
#   path = here::here("data", "survey_responses_clean.csv"),
#   overwrite = TRUE
# )

# read into R
df <- readr::read_csv(here::here("data", "survey_responses.csv"))

# read supporting data files in as well
compensation_bin_crosswalk <- readr::read_csv(
  here::here("data", "compensation_bin_crosswalk.csv")
)

col_names <-  readr::read_csv(
  here::here("data", "col_name_helper.csv")
)

# source all functions
func_files <- list.files(
  path = here::here("analysis", "functions"), full.names = TRUE
)
sapply(func_files, source)

```

```{r, message = FALSE, echo = FALSE }
# Subset to Survey Universe
df <- df %>%
  filter(eligible == TRUE)

# Salary
## TODO: Figure out how to deal with outlier salary values

# Years of Experience
## TODO: Figure out how to deal with outlier years of experience
df$years_worked_data[!is.na(df$years_worked_data) &
                       df$years_worked_data >= 35
                       ] <- NA

df$years_worked_political_data[!is.na(df$years_worked_data) &
                       df$years_worked_political_data >= 35
                       ] <- NA

df$years_worked_political[!is.na(df$years_worked_data) &
                       df$years_worked_political >= 35
                       ] <- NA


# remove people who didnt complete the survey
df <- df %>% filter(status == "Complete")

# remove people who enter a salary of 0 
df <- df %>% filter(compensation != 0)
```




# Respondent Charateristics

## Demographic Information {.tabset}


### Gender

**What is your gender identity?**


```{r, echo=FALSE}
tt(df$gender, order_prop = T)
```

### Race / Ethnicity
**What is your race / ethnicity? Please select all that apply.**

```{r, message = FALSE, echo = FALSE }
tt(df$race_bin,
   order_prop = T,
   last_ord = "Missing"
   )
```



### Immigration Status
**How long have you or your family lived in the United States?**

```{r, message = FALSE, echo = FALSE }
tt(df$immigration,
   order_prop = F,
   lvls = c("I’m the first generation in the United States",
            "One or more of my parents immigrated to the United States",
            "One or more of my grandparents immigrated to the United States",
            "My family has been in the United States for 3 generations or more",
            "None of the above",
            "Prefer not to answer"),
   last_ord = "Missing"
   )
```

### Age
**2020 - What is your year (YYYY) of birth?**



```{r, message = FALSE, echo = FALSE }
tt(df$age_bin, order_prop = F)
```

```{r, message = FALSE, echo = FALSE }
median_hist(df$age,
            x_label = "Age",
            med_label = "The median age is",
            med_label_x_cord = median(df$age, na.rm = TRUE) + 7,
            med_label_y_cord = 50, 
            color_hist = "#440154FF"
            )
# + geom_histogram(fill = c("red"))
```

### Sexuality
**Do you consider yourself to be ...?**
```{r, message = FALSE, echo = FALSE }
tt(df$sexual_orientation,
   order_prop = T,
   last_ord = c("Prefer not to answer", "Missing")
   )
```

### Disability
**Do you identify as a disabled? You are considered to have a disability if you have a physical or mental impairment or medical condition that substantially limits a major life activity, or if you have a history or record of such an impairment or medical condition.**

```{r, message = FALSE, echo = FALSE }
tt(df$disabled,
   order_prop = F, 
   lvls = c("Yes, I have or previously had a disability", "No, I don't have a disability", "Other", "Prefer not to answer"))
```



### Military Status
**Are you a member of the military or a veteran?**
```{r, message = FALSE, echo = FALSE }
tt(df$military_status, 
   order_prop = F, 
   lvls = c("Yes, Reserve/National Guard", "Yes, Veteran", "No", "Prefer not to answer"))

```


## Education
**What is the highest level of education that you have completed?**
```{r, message = FALSE, echo = FALSE }
tt(df$education_level,
   order_prop = F,
   lvls = c("High School Diploma or GED",
            "Associate's Degree",
            "Bachelor’s Degree",
            "Post-bachelor’s Work, no Higher Degree",
            "Master’s or Professional Degree (MA, MPP, JD, etc.)",
            "Doctoral Degree (PhD)",
            "Other", 
            "Prefer not to answer")
   )
```


## Geography {.tabset}

### Country

**What country do you live in? **
```{r, message = FALSE, echo = FALSE }
# this is now user-submitted rather than IP generated

tt(df$country, order_prop = T)
```

### Area
**What's your zip code?**  [only asked to US respondents, responses coded to Census metropolitan areas]

```{r, message = FALSE, echo = FALSE }
low_num_areas <- df %>%
  count(geo_name) %>%
  filter(n < 5)

df$geo_name_bin <- df$geo_name
df$geo_name_bin[df$geo_name %in% low_num_areas$geo_name] <- "Other (less than 5 people in metro area)"

tt(df$geo_name_bin, order_prop = T, last_ord = c("Other (less than 5 in metro area)", "Missing"))
```


## Work Experience {.tabset}
### Politics & Data
**How many years of work experience do you have in progressive politics and in data, analytics, and technology (i.e., how many years have you been a progressive data, analytics, or technology practitioner)?**

```{r, message = FALSE, echo = FALSE }
median_hist(
  df$years_worked_political_data,
  x_label = "Years in Politics & Data",
  med_label = "The median years of experience is",
  med_label_x_cord = median(df$years_worked_political_data, na.rm = TRUE) + 7,
  med_label_y_cord = 75, 
  color_hist = "#932667FF")
```

### Politics, Not Data
**How many years of work experience do you have in progressive politics but not in data, analytics, and technology (i.e., exclude any years worked in data, analytics, and technology)?**

```{r, message = FALSE, echo = FALSE }
median_hist(
  df$years_worked_political,
  x_label = "Years in Politics But Not Data",
  med_label = "The median years of experience is",
  med_label_x_cord = median(df$years_worked_political, na.rm = TRUE) + 8,
  med_label_y_cord = 75, 
  color_hist = "#DD513AFF"
  )
```


### Data, Not Politics
**How many years of work experience do you have in data, analytics, and technology but not in progressive politics (i.e., exclude any years worked in progressive politics)?**
```{r, message = FALSE, echo = FALSE }
median_hist(df$years_worked_data,
            x_label = "Years in Data But Not Politics",
            med_label = "The median years of experience is",
            med_label_x_cord = median(df$years_worked_data, na.rm = TRUE) + 10,
            med_label_y_cord = 50, 
            color_hist = "#FCA50AFF"
  )
```


### Total

```{r, message = FALSE, echo = FALSE }
total_work_experience <- df %>%
  select(years_worked_political_data,
         years_worked_political,
         years_worked_data) %>%
  mutate(sum = rowSums(.[1:3]))%>%
  filter(!is.na(sum))

median_hist(
  total_work_experience$sum,
  x_label = "Total Years",
  med_label = "The median years of experience is",
  med_label_x_cord = median(total_work_experience$sum, na.rm = TRUE) + 17,
  med_label_y_cord = 50, 
  color_hist = "#BB3754FF"
  )
```

## Employment Status {.tabset}

### Current Status
**What is your current employment status (as of January 2021)?**
```{r, message = FALSE, echo = FALSE }
mult_resp(df, "employment_status_jan_21",  order_prop = T)
```



### During 2020 election cycle
**What was your employment status during the 2020 election cycle?**
```{r, message = FALSE, echo = FALSE }
mult_resp(df, "employment_status_cycle_20",  order_prop = T)
```

### Employed in 2020 (full/part time) --> Jan 2021 Employment Status 
**REMOVE**
```{r, message = FALSE, echo = FALSE }
mult_resp(df %>% filter(employment_status_cycle_20.resp.full_time == TRUE |
                          employment_status_cycle_20.resp.part_time == TRUE),
          "employment_status_jan_21",
          order_prop = T)
```


### Involvement in Data/Analytics/Tech

* Is the primary focus (>40% of resources) of your **organization** data, analytics, or technology?
* Is the primary focus (>40% of resources) of your **team** data, analytics, or technology?
* Is the primary focus (>40% of time) of your **role** data, analytics or technology?



```{r, message = FALSE, echo = FALSE }
# make a df of just the columns/values we are interested in 

tmp <- df %>%
  select(data_40_org, data_40_team, data_40_role) %>%
  filter(!is.na(data_40_org), !is.na(data_40_team),!is.na(data_40_role))

# reshape the df
tmp$category <- row.names(tmp)
tmp2 <- reshape2::melt(tmp, id.vars = "category")


plot_data <- tmp2 %>%
  # for each question, get percents of people who answered yes and no
  count(variable, value) %>%
  group_by(variable) %>%
  mutate(pct = n /sum(n)) %>%
  # create label for bar plot
  mutate(bar_label =  paste0(
     sprintf("%.1f%%", round(100 * pct)), " (n = ", n, ")")) %>%
  # for the "no" values make the bar_label empty string 
  mutate(bar_label= ifelse(value == "No", " ", bar_label))%>%
  # rename values in variable column so it easier to plot
  mutate(variable = case_when(
   variable == "data_40_org" ~ "Organization",
   variable == "data_40_team" ~ "Team",
   variable == "data_40_role" ~ "Role"
   )
  ) %>%
  # factor columns so it follows a particular ordering
  mutate(
    variable = factor(variable,
                      levels = c("Role", "Team", "Organization")))


p <- ggplot(plot_data, aes(x = variable, y = pct, fill = value)) +
  geom_col(width = 0.7) +
  coord_flip() +
  scale_fill_viridis_d() +
  theme_bw() +
  # remove x and y axis label
   theme(axis.title.x = element_blank(),
         axis.title.y = element_blank()
         ) +
  # make the x-axis into percents
  scale_y_continuous(labels = scales::percent) +
  # add labels
  geom_text(aes(label = bar_label),
            position = position_stack(vjust = 0.5)) +
  # edit legend: remove the key and reverse the order of the values
  theme(legend.title = element_blank()) +
  guides(fill = guide_legend(reverse = TRUE))

p

```



# Job Characteristics
## Organization Type
**How would you describe the organization?**
```{r, message = FALSE, echo = FALSE }
tt(df$org_type, order_prop = T, last_ord = 'Other')
```


## Primary Job Function
**What is your primary job function? If in management, please indicate the primary job function of your team.**
```{r, message = FALSE, echo = FALSE }
tt(df$job_team_function, order_prop = T, last_ord = 'Other')
```

## Seniority {.tabset}

**How would you describe your level of seniority within the organization?**

### Overall 

```{r, message = FALSE, echo = FALSE }
tt(df$seniority_level,
   lvls = c(
     "Entry-Level",
     "Mid-Level",
     "Senior-Level, but not Department Head",
     "Department Head",
     "Organization Head, President or C-Level",
      "Other",
     "Freelance"),
   order_prop = F)
```

### By Gender 
```{r, message = FALSE, echo = FALSE }
cat_cross(x = df, 
  question = seniority_level, 
  cross_var = gender_bin, 
  order_by = "levels", 
  lvls = c(
     "Entry-Level",
     "Mid-Level", 
     "Senior-Level, but not Department Head", 
     "Department Head", 
     "Organization Head, President or C-Level", 
      "Other",
     "Freelance"),
  last_ord = NULL
            ) %>%
  # add some nice formatting 
      rename(' ' = question) %>%
      formattable::formattable(list(
        `All\n(n = 608)` = formattable::proportion_bar(), 
        `Cis man\n(n = 259)` = formattable::proportion_bar(), 
        `Non-Cis man\n(n = 341)` = formattable::proportion_bar()), 
        align = c('l', 'r', 'r', 'r', 'r'))
```


### By Race 
```{r, message = FALSE, echo = FALSE }
cat_cross(x = df, 
  question = seniority_level, 
  cross_var = race_bin, 
  order_by = "levels", 
  lvls = c(
     "Entry-Level",
     "Mid-Level", 
     "Senior-Level, but not Department Head", 
     "Department Head", 
     "Organization Head, President or C-Level", 
      "Other",
     "Freelance"),
  last_ord = NULL
            )  %>%
  # add some nice formatting 
      rename(' ' = question) %>%
      formattable::formattable(list(
        `All\n(n = 608)` = formattable::proportion_bar(), 
        `Asian or Asian American (including South Asian)\n(n = 77)` = formattable::proportion_bar(), 
        `Black\n(n = 30)` = formattable::proportion_bar(), 
        `Hispanic or Latinx\n(n = 33)`  = formattable::proportion_bar(),
        `Multi-Racial\n(n = 63)`  = formattable::proportion_bar(), 
        `White\n(n = 390)` = formattable::proportion_bar()), 
        align = c('l', 'r', 'r', 'r', 'r', 'r', 'r'))
```

### By Race (Binned)
```{r, message = FALSE, echo = FALSE }
cat_cross(x = df, 
  question = seniority_level, 
  cross_var = race_bin2, 
  order_by = "levels", 
  lvls = c(
     "Entry-Level",
     "Mid-Level", 
     "Senior-Level, but not Department Head", 
     "Department Head", 
     "Organization Head, President or C-Level", 
      "Other",
     "Freelance"),
  last_ord = NULL
            ) %>% 
  # add some nice formatting
      rename(' ' = question) %>%
      formattable::formattable(list(
        `All\n(n = 608)` = formattable::proportion_bar(),
        `POC/Other\n(n = 212)` = formattable::proportion_bar(),
        `White\n(n = 390)` = formattable::proportion_bar()),
        align = c('l', 'r', 'r', 'r', 'r'))
```


### By Gender x Race (Binned)
TODO: Figure out why proportion bars for 'POC/Other | Cis man (n = 85)' and 'White | Non-Cis man (n = 214)' are off. Probably beccause NA values. 
```{r, message = FALSE, echo = FALSE }
cat_cross(x = df, 
  question = seniority_level, 
  cross_var = gender_race, 
  order_by = "levels", 
  lvls = c(
     "Entry-Level",
     "Mid-Level", 
     "Senior-Level, but not Department Head", 
     "Department Head", 
     "Organization Head, President or C-Level", 
      "Other",
     "Freelance"), 
  last_ord = NULL
            ) %>%
  # add some nice formatting 
      rename(' ' = question) %>%
      formattable::formattable(list(
        `All\n(n = 608)` = formattable::proportion_bar(), 
        `POC/Other | Cis man\n(n = 85)` = formattable::proportion_bar(), 
        `POC/Other | Non-Cis man\n(n = 126)` = formattable::proportion_bar(), 
        `White | Cis man\n(n = 173)` = formattable::proportion_bar(), 
        `White | Non-Cis man\n(n = 214)` = formattable::proportion_bar()),
        align = c('l', 'r', 'r', 'r', 'r', 'r'))


```


## Management {.tabset}
**How many staffers do you manage? Please include everyone who reports "up the chain" to you, both directly or through layer(s) of management.**

### Overall
```{r, message = FALSE, echo = FALSE }
tt(df$num_staffers, order_prop = F,
   lvls = c(
     "0 staffers",
     "1-4 staffers",
     "5-9 staffers",
     "10-14 staffers",
     "More than 15 staffers"))
```


### By Gender 

```{r, message = FALSE, echo = FALSE }

cat_cross(x = df, 
  question = num_staffers, 
  cross_var = gender_bin, 
  order_by = "levels", 
  lvls = c(
     "0 staffers",
     "1-4 staffers", 
     "5-9 staffers",
     "10-14 staffers", 
     "More than 15 staffers"), 
  last_ord = NULL
            ) %>%
  # add some nice formatting 
      rename(' ' = question) %>%
      formattable::formattable(list(
        `All\n(n = 608)` = formattable::proportion_bar(), 
        `Cis man\n(n = 259)` = formattable::proportion_bar(), 
        `Non-Cis man\n(n = 341)` = formattable::proportion_bar()), 
        align = c('l', 'r', 'r', 'r', 'r'))

```




### By Race 
```{r, message = FALSE, echo = FALSE }

cat_cross(x = df, 
  question = num_staffers, 
  cross_var = race_bin, 
  order_by = "levels", 
  lvls = c(
     "0 staffers",
     "1-4 staffers", 
     "5-9 staffers",
     "10-14 staffers", 
     "More than 15 staffers"), 
  last_ord = NULL
) %>%
  # add some nice formatting 
      rename(' ' = question) %>%
      formattable::formattable(list(
        `All\n(n = 608)` = formattable::proportion_bar(), 
        `Asian or Asian American (including South Asian)\n(n = 77)` = formattable::proportion_bar(), 
        `Black\n(n = 30)` = formattable::proportion_bar(), 
        `Hispanic or Latinx\n(n = 33)`  = formattable::proportion_bar(),
        `Multi-Racial\n(n = 63)`  = formattable::proportion_bar(), 
        `White\n(n = 390)` = formattable::proportion_bar()), 
        align = c('l', 'r', 'r', 'r', 'r', 'r', 'r'))

```

### By Race (Binned)
```{r, message = FALSE, echo = FALSE }
cat_cross(x = df, 
  question = num_staffers, 
  cross_var = race_bin2, 
  order_by = "levels", 
  lvls = c(
     "0 staffers",
     "1-4 staffers", 
     "5-9 staffers",
     "10-14 staffers", 
     "More than 15 staffers"), 
  last_ord = NULL) %>%
  # add some nice formatting
      rename(' ' = question) %>%
      formattable::formattable(list(
        `All\n(n = 608)` = formattable::proportion_bar(),
        `POC/Other\n(n = 212)` = formattable::proportion_bar(),
        `White\n(n = 390)` = formattable::proportion_bar()),
        align = c('l', 'r', 'r', 'r', 'r'))

```

### By Gender x Race (Binned)
```{r, message = FALSE, echo = FALSE }

cat_cross(x = df, 
  question = num_staffers, 
  cross_var = gender_race, 
  order_by = "levels", 
  lvls = c(
     "0 staffers",
     "1-4 staffers", 
     "5-9 staffers",
     "10-14 staffers", 
     "More than 15 staffers"), 
  last_ord = NULL
            ) %>%
  # add some nice formatting 
      rename(' ' = question) %>%
      formattable::formattable(list(
        `All\n(n = 608)` = formattable::proportion_bar(), 
        `POC/Other | Cis man\n(n = 85)` = formattable::proportion_bar(), 
        `POC/Other | Non-Cis man\n(n = 126)` = formattable::proportion_bar(), 
        `White | Cis man\n(n = 173)` = formattable::proportion_bar(), 
        `White | Non-Cis man\n(n = 214)` = formattable::proportion_bar()),
        align = c('l', 'r', 'r', 'r', 'r', 'r'))
```



## Time Writing Code {.tabset}
**What percentage of your time do you spend directly conducting analysis or writing code - as opposed to other work such as communicating with external partners or managing staff?**

### Overall
```{r, message = FALSE, echo = FALSE }
x <- df$perc_time_coding * 100

plot <- ggplot(
    as.data.frame(x[!is.na(x)]),
      aes(
        x = x[!is.na(x)])) +
      geom_bar(stat = "count", fill = "#440154FF" ) +
      xlab("% of Time Conducting Analysis or Writing Code") +
      ylab("Count") + theme_bw() 
   
plot

```

### By Seniority

```{r, message = FALSE, echo = FALSE }
tmp <- df[which(!is.na(df$perc_time_coding) &
                  !is.na(df$seniority_level)),]
tmp <- df %>%
  filter(!is.na(seniority_level) & !is.na(perc_time_coding)) %>%
  # order seniority by most to least senior
  mutate(seniority_level = factor(seniority_level,
                                  levels = c("Other",
                                             "Freelance",
                                             "Entry-Level",
                                             "Mid-Level",
                                             "Senior-Level, but not Department Head",
                                             "Department Head",
                                             "Organization Head, President or C-Level"))) %>%
  # get Ns for people in each seniority bucket
  group_by(seniority_level) %>%
  mutate(seniority_level_n = n())  %>%
  ungroup() %>%
  # Add n-size to seniority_level label
  mutate(seniority_level_label = paste0(seniority_level, " (N = ", seniority_level_n, ")")) %>%
  # factor the label column based on the previous ordering by seniority type
  mutate(seniority_level_label = factor(seniority_level_label,
                                        levels =
                                        unique(seniority_level_label[order(seniority_level)]),
                                  ordered = TRUE))

# plot the density plot
ggplot(tmp, aes(x = perc_time_coding * 100,
           y = seniority_level_label)) +
  geom_density_ridges(rel_min_height = 0.01) +
 labs(x = "% of Time Conducting Analysis or Writing Code",
      y = " ") +
  theme_ridges() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(size = 10))




```

### By Job Type

```{r, message = FALSE, echo = FALSE }
tmp <- df %>%
  filter(!is.na(job_team_function) & !is.na(perc_time_coding)) %>%
  # calculate n-size for graph
  group_by(job_team_function) %>%
  mutate(job_team_n = n())  %>%
  ungroup() %>%
  # Add n-size to seniority_level label
  mutate(job_team_label = paste0(job_team_function, " (N = ", job_team_n, ")")) %>%
  # factor the label column in alphabetical order
  mutate(job_team_label = factor(job_team_label,
                                        levels =
                                        unique(job_team_label[order(job_team_label, decreasing = TRUE)]),
                                  ordered = TRUE))

# plot the density plot
ggplot(tmp, aes(x = perc_time_coding * 100,
           y = job_team_label)) +
  geom_density_ridges(rel_min_height = 0.01) +
 labs(x = "% of Time Conducting Analysis or Writing Code",
      y = " ") +
  theme_ridges() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(size = 10))

```





# Skills + Tools


## Tools {.tabset}

**How comfortable are you with the following skills and tools?**
https://stackoverflow.com/questions/43520318/how-to-use-percentage-as-label-in-stacked-bar-plot 

* **Never used this before**: Maybe you've heard of this tool, but you've never used it directly in or outside of work
* **Introductory**: You have maybe read about it or completed a tutorial, but you haven't used this in a major project
* **Novice**: You've used this a few times or use it at work, but you're still learning how it works
* **Intermediate**: You feel comfortable using this tool on your own
* **Advanced**: You are at home using this tool, are comfortable teaching or QCing others, or could lead a training on this topic


#### Skill Level 

This graph displays the full distribution of responses to skill level. Responses are ordered by the proportion of respondents who rate themselves as having intermediate or advanced skills.


```{r, message = FALSE, echo = FALSE }
# make a df of just the columns/values we are interested in
tmp <- df %>%
  select(contains("skills_comfort.resp")) 

# reshape the df
tmp$category <- row.names(tmp)
tmp2 <- reshape2::melt(tmp, id.vars = "category")


plot_data <- tmp2 %>%
  # for each question, get percents of people who answered never used, intro, novice, inetermediate, advanced
  count(variable, value) %>%
  group_by(variable) %>%
  mutate(pct = n /sum(n), 
  # create label for bar plot
  bar_label =  scales::label_percent(accuracy = 1)(pct), 
 # value = factor(value, levels = c("Never used this before", "Introductory", "Novice", "Intermediate", "Advanced"))) %>% 
  value = factor(value, levels = c( "Advanced", "Intermediate",  "Novice", "Introductory", "Never used this before"))) %>%
  # add cleanned verison of responses 
   left_join(
       col_names,
       by = c("variable" = "col_name_final"))

# rename values in variable column so it easier to plot

  # factor columns so it follows a particular ordering
  


p <- ggplot(plot_data, aes(x = response_name, y = pct, fill = value)) +
  geom_col(width = 0.7) +
  coord_flip() +
  scale_fill_viridis_d() +
  theme_bw() +
  # remove x and y axis label
   theme(axis.title.x = element_blank(),
         axis.title.y = element_blank()
         ) +
  # make the x-axis into percents
  scale_y_continuous(labels = scales::percent) +
  # add labels
  geom_text(aes(label = bar_label),
            position = position_stack(vjust = 0.5)) +
  # edit legend: remove the key and reverse the order of the values
  theme(legend.title = element_blank(), 
        legend.position = "bottom") +
   guides(fill = guide_legend(reverse = TRUE))

p
```


## Skills {.tabset}
**Which of the following items have you personally done in the last year? Please select all that apply.**

### Technical

```{r, message = FALSE, echo = FALSE }
# technical

tmp <- select(
  df,
  projects_done_management.resp.universes,
  projects_done_management.resp.rct,
  projects_done_management.resp.pipelines,
  projects_done_management.resp.stats_analysis,
  projects_done_management.resp.software_dev_manage,
  projects_done_management.resp.polling,
  projects_done_management.resp.build_model,
  projects_done_management.resp.software_dev,
  projects_done_management.resp.dev_ops, 
  projects_done_management.resp.reporting, 
  projects_done_technical.resp.none
              ) %>% 
  rename(projects_done_management.resp.none = projects_done_technical.resp.none)

mult_resp(tmp, "projects_done_management", order_prop = T)

```



### Management

```{r, message = FALSE, echo = FALSE }
tmp <- select(
  df,
  projects_done_management.resp.review_work,
  projects_done_management.resp.present_results,
  projects_done_management.resp.pitch_project,
  projects_done_management.resp.coordinate_orgs,
  projects_done_management.resp.hire_fire,
  projects_done_management.resp.create_prof_dev_plan, 
  projects_done_management.resp.none
              )

mult_resp(tmp, "projects_done_management", order_prop = T)
```


## Learn
**How did you learn the skills and tools you use weekly for your job? Please pick your top two options**

```{r, message = FALSE, echo = FALSE }
mult_resp(df, "skills_learning_method", order_prop = T)
```


### Free Text 
**Please describe any other major components of your work.**
```{r}
df$work_compenents_freetext[!is.na(df$work_compenents_freetext)] %>% dplyr::tibble()
```


# Salary Overview

**In US Dollars, what is your total expected annual pre-tax income, including bonuses or commissions? This figure may be salaried or unsalaried.**

```{r, message = FALSE, echo = FALSE }
df1 <- df %>%
  mutate( variable = "All") 

salary_cross(x = df1, 
             variable = variable,
             salary = compensation, 
             salary_bin = compensation_bin, 
             salary_bin_numeric = compensation_bin_numeric,
             order_by = "n") 

rm(df1)
```


## Salary Distribution {.tabset}

```{r, message = FALSE, echo = FALSE }
# input salary levels as labels, otherwise 100k is listed before 20k
salary_lvls <- df %>%
  arrange(compensation_bin_numeric) %>%
  select(compensation_bin) %>%
  unique() 

tt(df$compensation_bin, lvls = as.vector(salary_lvls$compensation_bin))
```

## Benefits

**Which of the following benefits are you personally eligible for? Select all that apply.**
```{r, message = FALSE, echo = FALSE }
mult_resp(df, "benefits.resp", order_prop = T)
```

## Negotiation {.tabset}

### Try Negotiate {.tabset}
**During your last job offer or performance review, did you try to negotiate your salary?**


#### Overall 

```{r, message = FALSE, echo = FALSE }
tt(df$negotiate_yesno, 
   lvls = c("Yes", "No", "Not applicable (union, freelancer, etc.)"),
   last_ord = "Missing")
```


#### By Gender 


```{r, message = FALSE, echo = FALSE }
cat_cross(x = df, 
  question = negotiate_yesno, 
  cross_var = gender_bin, 
  order_by = "levels", 
  lvls = c("Yes", "No", "Not applicable (union, freelancer, etc.)"), 
  last_ord = NULL
            ) %>%
  # add some nice formatting 
      rename(' ' = question) %>%
      formattable::formattable(list(
        `All\n(n = 608)` = formattable::proportion_bar(), 
        `Cis man\n(n = 259)` = formattable::proportion_bar(), 
        `Non-Cis man\n(n = 341)` = formattable::proportion_bar()), 
        align = c('l', 'r', 'r', 'r'))
```



#### By Race (Binned)
```{r, message = FALSE, echo = FALSE }
cat_cross(x = df, 
  question = negotiate_yesno, 
  cross_var = race_bin2, 
  order_by = "levels", 
  lvls = c("Yes", "No", "Not applicable (union, freelancer, etc.)"), 
  last_ord = NULL
            ) %>%
  # add some nice formatting 
      rename(' ' = question) %>%
      formattable::formattable(list(
        `All\n(n = 608)` = formattable::proportion_bar(), 
        `POC\n(n = 212)` = formattable::proportion_bar(), 
        `White\n(n = 390)` = formattable::proportion_bar()), 
        align = c('l', 'r', 'r', 'r', 'r'))

```

#### By Gender x Race (Binned)

```{r, message = FALSE, echo = FALSE }

cat_cross(x = df, 
  question = negotiate_yesno, 
  cross_var = gender_race, 
  order_by = "levels", 
  lvls = c("Yes", "No", "Not applicable (union, freelancer, etc.)"), 
  last_ord = NULL
            ) %>%
  # add some nice formatting 
      rename(' ' = question) %>%
      formattable::formattable(list(
        `All\n(n = 608)` = formattable::proportion_bar(), 
        `POC/Other | Cis man\n(n = 85)` = formattable::proportion_bar(), 
        `POC/Other | Non-Cis man\n(n = 126)` = formattable::proportion_bar(), 
        `White | Cis man\n(n = 173)` = formattable::proportion_bar(), 
        `White | Non-Cis man\n(n = 214)` = formattable::proportion_bar()),
        align = c('l', 'r', 'r', 'r', 'r', 'r'))

```


### Negotiation Successful {.tabset}
**Was your negotiation successful? Please select all that apply.** [only asked to respondents who attempted a negotiation]

#### Overall
```{r, message = FALSE, echo = FALSE }

mult_resp(df %>% filter(negotiate_yesno =="Yes"),
          "negotiation_result")
```



#### By Gender 

```{r, message = FALSE, echo = FALSE }
mult_resp_cross(
  x = df %>% # remove people who didn't answer yes to the previous question
  filter(negotiate_yesno =="Yes"),
  question_prefix = "negotiation_result", 
  cross_var = gender_bin
  )  %>%
  # add some nice formatting 
      rename(' ' = response_name) %>%
      formattable::formattable(list(
        `All\n(n = 219)` = formattable::proportion_bar(), 
        `Cis man\n(n = 92)` = formattable::proportion_bar(), 
        `Non-Cis man\n(n = 124)` = formattable::proportion_bar(), 
        `Prefer not to answer\n(n = 3)` = formattable::proportion_bar()),
        align = c('l', 'r', 'r', 'r', 'r'))
```

#### By Race
```{r, message = FALSE, echo = FALSE }
mult_resp_cross(
  x = df %>% # remove people who didn't answer yes to the previous question
  filter(negotiate_yesno =="Yes"),
  question_prefix = "negotiation_result", 
  cross_var = race_bin2
  )  %>%
  # add some nice formatting 
      rename(' ' = response_name) %>%
      formattable::formattable(list(
        `All\n(n = 219)` = formattable::proportion_bar(), 
        `POC/Other\n(n = 85)` = formattable::proportion_bar(), 
        `White\n(n = 133)` = formattable::proportion_bar()),
        align = c('l', 'r', 'r', 'r', 'r'))
```

#### By Gender x Race 
```{r, message = FALSE, echo = FALSE }
mult_resp_cross( x = df %>% # remove people who didn't answer yes to the previous question
  filter(negotiate_yesno =="Yes"),
  question_prefix = "negotiation_result", 
  cross_var = gender_race
            ) %>%
  # add some nice formatting 
      rename(' ' = response_name) %>%
      formattable::formattable(list(
        `All\n(n = 219)` = formattable::proportion_bar(), 
        `POC/Other | Cis man\n(n = 37)` = formattable::proportion_bar(), 
        `POC/Other | Non-Cis man\n(n = 48)` = formattable::proportion_bar(), 
        `White | Cis man\n(n = 55)` = formattable::proportion_bar(), 
        `White | Non-Cis man\n(n = 76)` = formattable::proportion_bar()),
        align = c('l', 'r', 'r', 'r', 'r', 'r'))

```


## Professional Development {.tabset}

### Opportunity
**Does your employer offer any career development opportunities?**
```{r, message = FALSE, echo = FALSE }
tt(
  x = df$prof_dev_yesno, 
  order_prop = F, 
  lvls = c("Yes", "Yes, but I am not eligible", "No", "Not sure")
  )
```



### Available 
**What types of employer-funded professional development opportunities are available to you? Please select all that apply.** [only asked to respondents who are offered career development opportunities]
```{r, message = FALSE, echo = FALSE }
mult_resp(df %>% filter(prof_dev_yesno == "Yes"),
          "prof_dev_available",
          order_prop = T)
```



### Used 
**Which of these professional development opportunities have you used? Please select all that apply.** [only asked to respondents who are offered career development opportunities]


TODO: Add logic to valid response. People should only select values that they selected in prof_dev_available.

```{r, message = FALSE, echo = FALSE }
mult_resp(df %>% filter(prof_dev_yesno == "Yes"),
          "prof_dev_used", 
          order_prop = T)
```


### Free Text 
**Thinking about your career path and focus, which one specific skill or tool do you most want to learn?**
```{r}
# order by count
as.data.frame(table(df$skill_to_learn)) %>% dplyr::arrange(desc(Freq)) %>% top_n(20)
```

```{r}
df$skill_to_learn[!is.na(df$skill_to_learn)] %>% dplyr::tibble()
```


TODO

# Salary Crosstabs 

In all of the following crosstabs, salary information is excluded for groups with fewer than 5 people.

## Respondent Characteristics {.tabset}

### Gender

```{r, message = FALSE, echo = FALSE }

salary_cross(x = df,
             variable = gender,
             salary = compensation, 
             salary_bin = compensation_bin, 
             salary_bin_numeric = compensation_bin_numeric,
             order_by = "n")




```

```{r, message = FALSE, echo = FALSE }

df2 <- df %>%
  select(gender_bin, compensation, years_worked_political_data, years_worked_political, years_worked_data) %>%
  filter(
    !is.na(gender_bin),
    !is.na( compensation),
    !is.na(years_worked_political_data),
    !is.na(years_worked_political),
    !is.na(years_worked_data),
    gender_bin != 'Prefer not to answer') %>%
  transmute(
   variable = gender_bin,
    salary_total =  compensation,
    work_pol_data = years_worked_political_data,
    work_pol_nodata = years_worked_political,
    work_nopol_data = years_worked_data) %>%
  mutate(totalyears = rowSums(.[3:5])) %>%
  arrange(desc(salary_total))

# rm outlier
df2 <- df2[df2$totalyears <= 35,]

## creates chart
ggplot(df2, aes(x = totalyears, y = salary_total, color = variable)) +
  geom_jitter(stat = "identity", width = 2, height = 2) +
  geom_smooth(method = "loess", se = FALSE) +
  theme_light()+
  theme(legend.title=element_blank())+
  xlab("Years of Experience")+
  ylab("Salary")

```

### Gender (Binned)

```{r, message = FALSE, echo = FALSE }

salary_cross(x = df,
             variable = gender_cis,
             salary = compensation, 
             salary_bin = compensation_bin, 
             salary_bin_numeric = compensation_bin_numeric,
             order_by = "n")




```


```{r, message = FALSE, echo = FALSE }

df2 <- df %>%
  select(gender_cis, compensation, years_worked_political_data, years_worked_political, years_worked_data) %>%
  filter(
    !is.na(gender_cis),
    !is.na( compensation),
    !is.na(years_worked_political_data),
    !is.na(years_worked_political),
    !is.na(years_worked_data),
    gender_cis != 'Prefer not to answer') %>%
  transmute(
   variable = gender_cis,
    salary_total =  compensation,
    work_pol_data = years_worked_political_data,
    work_pol_nodata = years_worked_political,
    work_nopol_data = years_worked_data) %>%
  mutate(totalyears = rowSums(.[3:5])) %>%
  arrange(desc(salary_total))

# rm outlier
df2 <- df2[df2$totalyears <= 35,]

## creates chart
ggplot(df2, aes(x = totalyears, y = salary_total, color = variable)) +
  geom_jitter(stat = "identity", width = 2, height = 2) +
  geom_smooth(method = "loess", se = FALSE) +
  theme_light()+
  theme(legend.title=element_blank())+
  xlab("Years of Experience")+
  ylab("Salary")

```

### Race / Ethnicity

```{r, message = FALSE, echo = FALSE }

salary_cross(x = df, 
             variable = race_bin,
             salary = compensation, 
             salary_bin = compensation_bin, 
             salary_bin_numeric = compensation_bin_numeric,
             order_by = "n", # n, levels, alpha
             last_ord = c("Other/Prefer Not to Say/Missing")
             ) 
```

### Race / Ethnicity (Binned)

```{r, message = FALSE, echo = FALSE }

salary_cross(x = df, 
             variable = race_bin2,
             salary = compensation, 
             salary_bin = compensation_bin, 
             salary_bin_numeric = compensation_bin_numeric,
             order_by = "n", # n, levels, alpha
             last_ord = c("Prefer not to answer")
             ) 
```

```{r, message = FALSE, echo = FALSE }

df2 <- df %>%
  select(race_bin2, compensation, years_worked_political_data, years_worked_political, years_worked_data) %>%
  filter(
    !is.na(race_bin2),
    !is.na( compensation),
    !is.na(years_worked_political_data),
    !is.na(years_worked_political),
    !is.na(years_worked_data),
    race_bin2 != 'Prefer not to answer') %>%
  transmute(
    race = race_bin2,
    salary_total =  compensation,
    work_pol_data = years_worked_political_data,
    work_pol_nodata = years_worked_political,
    work_nopol_data = years_worked_data) %>%
  mutate(totalyears = rowSums(.[3:5])) %>%
  arrange(desc(salary_total))

# rm outlier
df2 <- df2[df2$totalyears <= 35,]

## creates chart
ggplot(df2, aes(x = totalyears, y = salary_total, color = race)) +
  geom_jitter(stat = "identity", width = 2, height = 2) +
  geom_smooth(method = "loess", se = FALSE) +
  theme_light()+
  theme(legend.title=element_blank())+
  xlab("Years of Experience")+
  ylab("Salary")

```


### Gender x Race / Ethnicity 


```{r, message = FALSE, echo = FALSE }

salary_cross(x = df, 
             variable = gender_race,
             salary = compensation, 
             salary_bin = compensation_bin, 
             salary_bin_numeric = compensation_bin_numeric,
             order_by = "n", # n, levels, alpha
             last_ord = c("Other/Prefer Not to Say/Missing")
             ) 

```


```{r, message = FALSE, echo = FALSE }

df2 <- df %>%
   mutate(gender_race = paste(race_bin2, gender_bin, sep = " | ")) %>%
  select(gender_race, compensation, years_worked_political_data, years_worked_political, years_worked_data) %>%
  filter(
    !is.na( compensation),
    !is.na(years_worked_political_data),
    !is.na(years_worked_political),
    !is.na(years_worked_data),
    gender_race %in% c("POC/Other | Non-Cis man",
                       "White | Non-Cis man",
                       "POC/Other | Cis man", 
                       "White | Cis man")) %>%
  transmute(
   variable = gender_race,
    salary_total =  compensation,
    work_pol_data = years_worked_political_data,
    work_pol_nodata = years_worked_political,
    work_nopol_data = years_worked_data) %>%
  mutate(totalyears = rowSums(.[3:5])) %>%
  arrange(desc(salary_total))

# rm outlier
df2 <- df2[df2$totalyears <= 35,]

## creates chart
ggplot(df2, aes(x = totalyears, y = salary_total, color = variable)) +
  geom_jitter(stat = "identity", width = 2, height = 2) +
  scale_color_viridis_d(option = "magma") +
  geom_smooth(method = "loess", se = FALSE) +
  theme(legend.title = element_blank())+
  xlab("Years of Experience")+
  ylab("Salary") +
  theme_bw() 

```


### Age

```{r, message = FALSE, echo = FALSE }
salary_cross(x = df, 
             variable = age_bin,
             salary = compensation, 
             salary_bin = compensation_bin, 
             salary_bin_numeric = compensation_bin_numeric,
             order_by = "alpha", # mean, levels, alpha
             last_ord = c("Other/Prefer Not to Say/Missing")
             ) 


```


### Sexuality 
```{r, message = FALSE, echo = FALSE }
salary_cross(x = df, 
             variable = sexual_orientation,
             salary = compensation, 
             salary_bin = compensation_bin, 
             salary_bin_numeric = compensation_bin_numeric,
             order_by = "n", # n, levels, alpha
             last_ord = c("Other/Prefer Not to Say/Missing")
             ) 

```


### Sexuality (Binned)
```{r, message = FALSE, echo = FALSE }
salary_cross(x = df, 
             variable = sexual_orientation_bin,
             salary = compensation, 
             salary_bin = compensation_bin, 
             salary_bin_numeric = compensation_bin_numeric,
             order_by = "n" # n, levels, alpha
             ) 

```

```{r, message = FALSE, echo = FALSE }

df2 <- df %>%
  select(sexual_orientation_bin, compensation, years_worked_political_data, years_worked_political, years_worked_data) %>%
  filter(
    !is.na(sexual_orientation_bin),
    !is.na( compensation),
    !is.na(years_worked_political_data),
    !is.na(years_worked_political),
    !is.na(years_worked_data),
    sexual_orientation_bin != 'Prefer not to answer') %>%
  transmute(
   variable = sexual_orientation_bin,
    salary_total =  compensation,
    work_pol_data = years_worked_political_data,
    work_pol_nodata = years_worked_political,
    work_nopol_data = years_worked_data) %>%
  mutate(totalyears = rowSums(.[3:5])) %>%
  arrange(desc(salary_total))

# rm outlier
df2 <- df2[df2$totalyears <= 35,]

## creates chart
ggplot(df2, aes(x = totalyears, y = salary_total, color = variable)) +
  geom_jitter(stat = "identity", width = 2, height = 2) +
  geom_smooth(method = "loess", se = FALSE) +
  theme_light()+
  theme(legend.title=element_blank())+
  xlab("Years of Experience")+
  ylab("Salary")

```

### Disability 
```{r, message = FALSE, echo = FALSE }
salary_cross(x = df, 
             variable = disabled,
             salary = compensation, 
             salary_bin = compensation_bin, 
             salary_bin_numeric = compensation_bin_numeric,
             order_by = "levels", # mean, levels, alpha
             lvls = c("Yes, I have or previously had a disability", 
                      "No, I don't have a disability", "Other"),
             last_ord = c("Prefer not to answer", "Missing")
             ) 
```


### Immigration Status
**DELETE**
```{r, message = FALSE, echo = FALSE }

salary_cross(x = df, 
             variable = immigration,
             salary = compensation, 
             salary_bin = compensation_bin, 
             salary_bin_numeric = compensation_bin_numeric,
             order_by = "levels", # n, levels, alpha
             lvls = c("I’m the first generation in the United States",
            "One or more of my parents immigrated to the United States",
            "One or more of my grandparents immigrated to the United States",
            "My family has been in the United States for 3 generations or more",
            "None of the above",
            "Prefer not to answer")
             ) 

```




## Education 
```{r, message = FALSE, echo = FALSE }


salary_cross(x = df, 
             variable = education_level,
             salary = compensation, 
             salary_bin = compensation_bin, 
             salary_bin_numeric = compensation_bin_numeric,
             order_by = "levels", # mean, levels, alpha
              lvls = c("High School Diploma or GED", 
                       "Associate's Degree", 
                       "Bachelor’s Degree", 
                       "Post-bachelor’s Work, no Higher Degree", 
                       "Master’s or Professional Degree (MA, MPP, JD, etc.)", 
                       "Doctoral Degree (PhD)", 
                       "Other"), 
    last_ord = c("Prefer not to answer", "Missing")
             ) 


```


## Work Experience 

```{r, message = FALSE, echo = FALSE }
salary_work <- df %>%
  select( compensation, years_worked_political_data, years_worked_political, years_worked_data) %>%
  filter(!is.na( compensation),
         !is.na(years_worked_political_data),
         !is.na(years_worked_political),
         !is.na(years_worked_data)) %>%
  transmute(
    salary_total =  compensation,
    work_pol_data = years_worked_political_data,
    work_pol_nodata = years_worked_political,
    work_nopol_data = years_worked_data) %>%
  mutate(totalyears = rowSums(.[2:4])) %>%
  arrange(desc(salary_total))

salary_work <- salary_work[salary_work$totalyears <= 35,]

## creates chart
ggplot(salary_work, aes(x = totalyears, y = salary_total)) +
  geom_jitter(stat = "identity", width = 2, height = 2) +
  geom_smooth(method = "loess") +
  theme_light()+
  xlab("Years of Experience")+
  ylab("Salary")
```


## Job Characteristics {.tabset}


### Organization 
```{r, message = FALSE, echo = FALSE }
salary_cross(x = df,
             variable = org_type,
             salary = compensation,
             salary_bin = compensation_bin, 
             salary_bin_numeric = compensation_bin_numeric,
             order_by = "n", # n, levels, alpha

             lvls = NULL,
             last_ord = NULL)
```


### Seniority 

```{r, message = FALSE, echo = FALSE }

salary_cross(x = df, 
             variable = seniority_level,
             salary = compensation, 
             salary_bin = compensation_bin, 
             salary_bin_numeric = compensation_bin_numeric,
             order_by = "levels", # mean, levels, alpha
              lvls = c("Entry-Level",
                         "Mid-Level",
                         "Senior-Level, but not Department Head",
                         "Department Head",
                         "Organization Head, President or C-Level", 
                         "Other",
                         "Freelance"))

```

### Seniority Binned ( entry / mid / senior)
**MOVE TO APPENDIX**

```{r, message = FALSE, echo = FALSE }

salary_cross(x = df %>% 
               mutate(
                 seniority_level_binned = case_when(
                 seniority_level == "Entry-Level" ~ "Entry-Level",
                 seniority_level == "Mid-Level" ~ "Mid-Level",
                 seniority_level %in% c("Organization Head, President or C-Level", 
                                        "Senior-Level, but not Department Head", 
                                        "Department Head") ~ "Senior-Level", 
                 seniority_level == "Other" ~ "Other", 
                 seniority_level == "Freelance" ~ "Freelance"
                 )
                 ), 
             variable = seniority_level_binned,
             salary = compensation, 
             salary_bin = compensation_bin, 
             salary_bin_numeric = compensation_bin_numeric,
             order_by = "levels", # mean, levels, alpha
              lvls = c("Entry-Level",
                         "Mid-Level",
                         "Senior-Level", 
                         "Other",
                         "Freelance"))

```


### Management 

```{r, message = FALSE, echo = FALSE }


salary_cross(x = df, 
             variable = num_staffers,
             salary = compensation, 
             salary_bin = compensation_bin, 
             salary_bin_numeric = compensation_bin_numeric,
             order_by = "levels", # n, levels, alpha
             lvls = c("0 staffers",
                      "1-4 staffers", 
                      "5-9 staffers",
                      "10-14 staffers", 
                      "More than 15 staffers"))
```


### Management Binned (0 staff, 1- 4, and >=5)
**MOVE TO APPENDIX**
```{r, message = FALSE, echo = FALSE }
salary_cross(x = df %>% mutate(
  num_staffers_bin = case_when(
    num_staffers == "0 staffers" ~ "0 staffers", 
    num_staffers == "1-4 staffers" ~ "1-4 staffers", 
    num_staffers != "0 staffers" | num_staffers != "1-4 staffers" ~ "5+ staffers"
    )
  ), 
  variable = num_staffers_bin,
  salary = compensation, 
  salary_bin = compensation_bin, 
  salary_bin_numeric = compensation_bin_numeric,
  order_by = "levels", # mean, levels, alpha
  lvls = c("0 staffers",
           "1-4 staffers", 
           "5+ staffers"))

```



### Primary Job Function 


```{r, message = FALSE, echo = FALSE }


salary_cross(x = df, 
             variable = job_team_function,
             salary = compensation, 
             salary_bin = compensation_bin, 
             salary_bin_numeric = compensation_bin_numeric,
             order_by = "n") 


```

### Time Writing Code 
**DELETE**
```{r, message = FALSE, echo = FALSE }
salary_cross(x = df, 
             variable = perc_time_coding,
             salary = compensation, 
             salary_bin = compensation_bin, 
             salary_bin_numeric = compensation_bin_numeric,
             order_by = "alpha") 

```

```{r, message = FALSE, echo = FALSE }
## creates chart
ggplot(df, aes(x = perc_time_coding * 100, y = compensation)) +
  geom_jitter(stat = "identity", width = 2, height = 2) +
  geom_smooth(method = "loess") +
  theme_light()+
  xlab("Percent of Time Writing Code")+
  ylab("Salary") 
```




# Career Plans {.tabset}


## Next Steps 

**Which of the following most accurately describes the next step you would like to take to advance your career? Please select all that apply.**
```{r, message = FALSE, echo = FALSE }
mult_resp(df, "next_career_step",  order_prop = T)
```

## Plans to Leave {.tabset}
**MOVE CROSSTABS TO APPENDIX**

### Overall 

**Are you planning to leave your organization within the next year?**
```{r, message = FALSE, echo = FALSE }
tt(df$leaving_org,
   order_prop =  F, 
   lvls = c("I plan to actively look for new opportunities",
            "I might leave, but I’m not sure", 
            "I’m not planning to leave", 
            "My current job / contract ends within the next 12 months", 
            "I am currently unemployed"
            )
   )
```

### By Gender 

```{r, message = FALSE, echo = FALSE }
cat_cross(x = df, 
          question = leaving_org, 
          cross_var = gender_bin, 
          order_by = "levels", 
          lvls = c("I plan to actively look for new opportunities",
            "I might leave, but I’m not sure", 
            "I’m not planning to leave", 
            "My current job / contract ends within the next 12 months", 
            "I am currently unemployed"), 
          last_ord = NULL) %>%
  # add some nice formatting 
      rename(' ' = question) %>%
      formattable::formattable(list(
        `All\n(n = 608)` = formattable::proportion_bar(), 
        `Cis man\n(n = 259)` = formattable::proportion_bar(), 
        `Non-Cis man\n(n = 341)` = formattable::proportion_bar()), 
        align = c('l', 'r', 'r', 'r', 'r'))
```


### By Race 
```{r, message = FALSE, echo = FALSE }
cat_cross(x = df, 
          question = leaving_org, 
          cross_var = race_bin, 
          order_by = "levels", 
          lvls = c("I plan to actively look for new opportunities",
            "I might leave, but I’m not sure", 
            "I’m not planning to leave", 
            "My current job / contract ends within the next 12 months", 
            "I am currently unemployed"), 
          last_ord = NULL)  %>%  # add some nice formatting 
      rename(' ' = question) %>%
      formattable::formattable(list(
        `All\n(n = 608)` = formattable::proportion_bar(), 
        `Asian or Asian American (including South Asian)\n(n = 77)` = formattable::proportion_bar(), 
        `Black\n(n = 30)` = formattable::proportion_bar(), 
        `Hispanic or Latinx\n(n = 33)`  = formattable::proportion_bar(),
        `Multi-Racial\n(n = 63)`  = formattable::proportion_bar(), 
        `White\n(n = 390)` = formattable::proportion_bar()), 
        align = c('l', 'r', 'r', 'r', 'r', 'r', 'r'))

```

### By Race Bin 
```{r, message = FALSE, echo = FALSE }
cat_cross(x = df, 
          question = leaving_org, 
          cross_var = race_bin2, 
          order_by = "levels", 
          lvls = c("I plan to actively look for new opportunities",
            "I might leave, but I’m not sure", 
            "I’m not planning to leave", 
            "My current job / contract ends within the next 12 months", 
            "I am currently unemployed"), 
          last_ord = NULL)  %>%
  # add some nice formatting 
      rename(' ' = question) %>%
      formattable::formattable(list(
        `All\n(n = 608)` = formattable::proportion_bar(), 
        `POC/Other\n(n = 212)` = formattable::proportion_bar(), 
        `White\n(n = 390)` = formattable::proportion_bar()), 
        align = c('l', 'r', 'r', 'r', 'r'))

```


### By Gender x Race 

```{r, message = FALSE, echo = FALSE }

cat_cross(x = df, 
          question = leaving_org, 
          cross_var = gender_race, 
          order_by = "levels", 
          lvls = c("I plan to actively look for new opportunities",
            "I might leave, but I’m not sure", 
            "I’m not planning to leave", 
            "My current job / contract ends within the next 12 months", 
            "I am currently unemployed"), 
          last_ord = NULL) %>%
  # add some nice formatting 
      rename(' ' = question) %>%
      formattable::formattable(list(
        `All\n(n = 608)` = formattable::proportion_bar(), 
        `POC/Other | Cis man\n(n = 85)` = formattable::proportion_bar(), 
        `POC/Other | Non-Cis man\n(n = 126)` = formattable::proportion_bar(), 
        `White | Cis man\n(n = 173)` = formattable::proportion_bar(), 
        `White | Non-Cis man\n(n = 214)` = formattable::proportion_bar()),
        align = c('l', 'r', 'r', 'r', 'r', 'r'))
```


## Why leaving 
**If you were to leave the progressive/Democratic data space in the next year, what would lead to that decision? Please select your top two reasons.**
```{r, message = FALSE, echo = FALSE }
mult_resp(df, "leaving_space", order_prop =  T)
```

## Expect to be in one year
**Where do you want or expect to be working a year from now? Select all that apply. ** [only asked to respondents who are either looking for new opportunities, might leave, on a job / contract that ends within the next 12 months, or currently unemployed]
```{r, message = FALSE, echo = FALSE }
mult_resp(df, "role_next_year", order_prop =  T)
```


# Covid

## Additional Benefits
**Regardless of whether you were eligible, did your employer offer any additional benefits due to the COVID-19 pandemic?**
```{r, message = FALSE, echo = FALSE }
tt(df$covid_benefits_yesno, 
   order_prop = F, 
   lvls = c("Yes", "No", "Unsure"))
```


## Benefits Offered 
**What sort of benefits were offered/provided? Please select all that apply.** [only asked to respondents whose organizations offered any additional benefits due to the COVID-19 pandemic]

```{r, message = FALSE, echo = FALSE }
mult_resp(df %>% filter(covid_benefits_yesno == "Yes"),
          "covid_benefits_specific", order_prop = T)
```

## Free Text
**Please briefly describe how your organization handled the COVID-19 pandemic to make things easier for staff. **
```{r}
df$covid_freetext[!is.na(df$covid_freetext)] %>% dplyr::tibble()
```

TODO

# Union {.tabset}

## Is Unionized?
**Is your organization unionized or does it have one or more recognized bargaining units?**
```{r, message = FALSE, echo = FALSE }
tt(df$is_unionized, lvls = c("Yes", "No", "Unsure"))
```

## Union Member? 
**Are you a member of the union/bargaining unit?** [only asked to respondents whose organization is unionized or has one or more recognized bargaining units]
```{r, message = FALSE, echo = FALSE }
tt(df$bargaining_unit_member[df$is_unionized == "Yes"], 
    lvls = c("Yes", "No, do not qualify for membership", "Unsure"))
```


## Date of Unionization 
**When did your organization unionize?** [only asked to respondents whose organization is unionized or has one or more recognized bargaining units]
```{r, message = FALSE, echo = FALSE }
tt(df$when_unionized[df$is_unionized == "Yes"], 
   lvls = c("Within the past two years", "In the past two to five years", "More than five years ago", "I’m not sure")
   )
```


# Notes {.tabset}


## Eligibility

Respondents were only eligible to take this survey if (1) they worked in progressive politics AND (2) if their organization, role, or team focused on data, analytics, or technology.

Respondents satisfied the first criteria if they answered “Yes” or "Did but employment ended post-election" to the following question:

* Do you currently work at an organization that either works in progressive politics or has some clients who work in progressive politics or do you currently work for a government body? Or, if you freelance, do you have some clients that work in progressive politics?


The second criteria was satisfied if the respondents answered “Yes” to one or more of the following questions:

* Is the primary focus (>40% of resources) of your organization data, analytics, or technology?
* Is the primary focus (>40% of resources) of your team data, analytics, or technology?
* Is the primary focus (>40% of time) of your role data, analytics or technology?


## Author and Thanks




